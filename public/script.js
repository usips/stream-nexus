(()=>{"use strict";const e={objectType:"ammo",objectScale:.1,objectSprites:["/static/img/ammo_556_round_a.png","/static/img/ammo_556_round_b.png","/static/img/ammo_556_round_c.png","/static/img/ammo_556_round_d.png"],restitution:.05,friction:.9,frictionAir:.01,density:.002,showLabels:!1,labelColor:"#ffff00",labelFont:"Verlag",labelSize:12,spawnRate:2,spawnDelay:50,maxObjects:500,showAngleIndicator:!1,wireframes:!1,fps:60};class t{constructor(t,s={}){this.objects=[],this.objectPool=[],this.isRunning=!1,this.precomputedVertices=null,this.cachedFontString="",this.frameCount=0,this.BOUNDARY_CHECK_INTERVAL=5,this.labelFrameCount=0,this.LABEL_RENDER_INTERVAL=3,this.spawnQueue=[],this.spawnQueueTimerId=null,this.config={...e,...s},this.viewportWidth=window.innerWidth,this.viewportHeight=window.innerHeight,this.precomputeVertices(),this.updateCachedFont(),this.boundHandleResize=this.handleResize.bind(this),this.boundAfterUpdate=this.onAfterUpdate.bind(this),this.boundAfterRender=this.onAfterRender.bind(this),document.body.style.overflow="hidden",document.body.style.margin="0",document.body.style.padding="0",this.engine=Matter.Engine.create({enableSleeping:!0,positionIterations:6,velocityIterations:4,constraintIterations:2}),this.world=this.engine.world,this.engine.gravity.y=.8,this.render=Matter.Render.create({element:t,engine:this.engine,options:{width:this.viewportWidth,height:this.viewportHeight,showAngleIndicator:this.config.showAngleIndicator,showBounds:!1,showSleeping:!1,wireframes:this.config.wireframes,background:"transparent"}}),this.runner=Matter.Runner.create({delta:1e3/this.config.fps}),this.bottomWall=Matter.Bodies.rectangle(this.viewportWidth/2,this.viewportHeight+25,this.viewportWidth,50,{isStatic:!0,render:{visible:!1}}),this.leftWall=Matter.Bodies.rectangle(-25,this.viewportHeight/2,50,2*this.viewportHeight,{isStatic:!0,render:{visible:!1}}),this.rightWall=Matter.Bodies.rectangle(this.viewportWidth+25,this.viewportHeight/2,50,2*this.viewportHeight,{isStatic:!0,render:{visible:!1}}),Matter.Composite.add(this.world,[this.bottomWall,this.leftWall,this.rightWall]);const n=Matter.Mouse.create(this.render.canvas),i=Matter.MouseConstraint.create(this.engine,{mouse:n,constraint:{stiffness:.2,render:{visible:!1}}});Matter.Composite.add(this.world,i),this.render.mouse=n,this.setupEventHandlers(),window.addEventListener("resize",this.boundHandleResize)}precomputeVertices(){const e=["85 0","105 120","115 200","115 780","105 800","125 850","125 980","45 980","45 850","65 800","55 780","55 200","65 120"].join(" ");this.precomputedVertices=Matter.Vertices.fromPath(e,void 0);const t=this.config.objectScale,s=Matter.Vertices.centre(this.precomputedVertices);this.precomputedVertices=this.precomputedVertices.map(e=>({x:(e.x-s.x)*t,y:(e.y-s.y)*t}))}updateCachedFont(){this.cachedFontString=`${this.config.labelSize}px ${this.config.labelFont}`}setupEventHandlers(){Matter.Events.on(this.engine,"afterUpdate",this.boundAfterUpdate),Matter.Events.on(this.render,"afterRender",this.boundAfterRender)}onAfterUpdate(){this.frameCount++,this.adaptPhysicsIterations(),this.frameCount%this.BOUNDARY_CHECK_INTERVAL===0&&this.checkBoundaries(),this.objects.length>this.config.maxObjects&&this.cleanupExcessObjects()}onAfterRender(){this.config.showLabels&&(this.labelFrameCount++,this.labelFrameCount%this.LABEL_RENDER_INTERVAL===0&&this.renderLabels())}adaptPhysicsIterations(){const e=this.objects.length;e>400?(this.engine.positionIterations=4,this.engine.velocityIterations=2,this.engine.constraintIterations=1):e>200?(this.engine.positionIterations=6,this.engine.velocityIterations=4,this.engine.constraintIterations=2):(this.engine.positionIterations=8,this.engine.velocityIterations=6,this.engine.constraintIterations=3)}checkBoundaries(){for(const e of this.objects){if(!e.active)continue;const t=e.body;if(t.isStatic||t.isSleeping)continue;let s=!1;const n={x:t.position.x,y:t.position.y};t.position.x<0?(n.x=50,s=!0):t.position.x>this.viewportWidth&&(n.x=this.viewportWidth-50,s=!0),t.position.y>this.viewportHeight+100&&(n.y=this.viewportHeight-50,s=!0),s&&(Matter.Body.setVelocity(t,{x:0,y:0}),Matter.Body.setAngularVelocity(t,0),Matter.Body.setPosition(t,n))}}cleanupExcessObjects(){const e=this.objects.length-this.config.maxObjects;if(e<=0)return;let t=0;for(let s=0;s<this.objects.length&&t<e;s++){const e=this.objects[s];e.active&&(this.deactivateObject(e),t++)}this.objects=this.objects.filter(e=>e.active)}deactivateObject(e){e.active=!1,Matter.Composite.remove(this.world,e.body),this.objectPool.length<100&&this.objectPool.push(e)}getPooledObject(e,t,s){let n=this.objectPool.pop();if(n)this.resetBody(n.body,e,t,s),n.username=s,n.active=!0,Matter.Composite.add(this.world,n.body);else{const i=this.createBody(e,t,s);n={body:i,username:s,active:!0},Matter.Composite.add(this.world,i)}return n}createBody(e,t,s){const n=this.precomputedVertices.map(e=>({x:e.x,y:e.y})),i=this.config.objectSprites[Math.floor(Math.random()*this.config.objectSprites.length)],o=Matter.Bodies.fromVertices(e,t,[n],{render:{sprite:{texture:i,xScale:this.config.objectScale,yScale:this.config.objectScale}},restitution:this.config.restitution,friction:this.config.friction,frictionAir:this.config.frictionAir,density:this.config.density,slop:.01,frictionStatic:.9});return s&&this.config.showLabels&&(o.label={text:s,color:this.config.labelColor}),Matter.Body.setAngle(o,Math.random()*Math.PI*2),o}resetBody(e,t,s,n){Matter.Body.setPosition(e,{x:t,y:s}),Matter.Body.setVelocity(e,{x:0,y:0}),Matter.Body.setAngularVelocity(e,0),Matter.Body.setAngle(e,Math.random()*Math.PI*2),e.isSleeping&&Matter.Sleeping.set(e,!1),n&&this.config.showLabels?e.label={text:n,color:this.config.labelColor}:e.label=null;const i=this.config.objectSprites[Math.floor(Math.random()*this.config.objectSprites.length)];e.render.sprite&&(e.render.sprite.texture=i)}renderLabels(){const e=this.render.canvas.getContext("2d");if(e){e.font=this.cachedFontString,e.strokeStyle="#000000",e.lineWidth=2,e.textAlign="center",e.textBaseline="bottom";for(const t of this.objects){if(!t.active)continue;const s=t.body,n=s.label;n?.text&&!s.isStatic&&(e.save(),e.translate(s.position.x,s.position.y),e.rotate(s.angle+Math.PI/2),e.fillStyle=n.color||this.config.labelColor,e.strokeText(n.text,10,6),e.fillText(n.text,10,6),e.restore())}}}handleResize(){const e=window.innerWidth,t=window.innerHeight;this.render.canvas.width=e,this.render.canvas.height=t,this.render.options.width=e,this.render.options.height=t,Matter.Render.lookAt(this.render,{min:{x:0,y:0},max:{x:e,y:t}}),Matter.Body.setPosition(this.bottomWall,{x:e/2,y:t+25}),Matter.Body.scale(this.bottomWall,e/(this.bottomWall.bounds.max.x-this.bottomWall.bounds.min.x),1),Matter.Body.setPosition(this.leftWall,{x:-25,y:t/2}),Matter.Body.scale(this.leftWall,1,2*t/(this.leftWall.bounds.max.y-this.leftWall.bounds.min.y)),Matter.Body.setPosition(this.rightWall,{x:e+25,y:t/2}),Matter.Body.scale(this.rightWall,1,2*t/(this.rightWall.bounds.max.y-this.rightWall.bounds.min.y));for(const s of this.objects){if(!s.active)continue;const n=s.body;if(n.isStatic)continue;const i={x:n.position.x,y:n.position.y};let o=!1;n.position.x>e&&(i.x=e-50,o=!0),n.position.x<0&&(i.x=50,o=!0),n.position.y>t&&(i.y=t-50,o=!0),o&&(Matter.Body.setPosition(n,i),Matter.Body.setVelocity(n,{x:0,y:0}),n.isSleeping&&Matter.Sleeping.set(n,!1))}this.viewportWidth=e,this.viewportHeight=t}start(){this.isRunning||(Matter.Render.run(this.render),Matter.Runner.run(this.runner,this.engine),Matter.Render.lookAt(this.render,{min:{x:0,y:0},max:{x:this.viewportWidth,y:this.viewportHeight}}),this.startSpawnQueue(),this.isRunning=!0)}stop(){this.isRunning&&(Matter.Render.stop(this.render),Matter.Runner.stop(this.runner),this.stopSpawnQueue(),this.isRunning=!1)}startSpawnQueue(){if(null!==this.spawnQueueTimerId)return;const e=()=>{const t=Date.now();for(;this.spawnQueue.length>0&&this.spawnQueue[0].scheduledTime<=t;){const e=this.spawnQueue.shift();this.spawnObjectImmediate(e.x,e.y,e.username)}this.spawnQueueTimerId=requestAnimationFrame(e)};this.spawnQueueTimerId=requestAnimationFrame(e)}stopSpawnQueue(){null!==this.spawnQueueTimerId&&(cancelAnimationFrame(this.spawnQueueTimerId),this.spawnQueueTimerId=null)}spawnObjectImmediate(e,t,s){if(void 0===t&&(t=-100),void 0===e){const t=this.viewportWidth/2,s=this.viewportWidth/2.5,n=2*Math.random()-1;e=t+s*n*n*(n<0?-1:1)}const n=this.getPooledObject(e,t,s);return this.objects.push(n),n.body}spawnObject(e,t,s){this.spawnQueue.push({x:e,y:t,username:s,scheduledTime:Date.now()})}handleDonation(e,t){const s=Math.floor(e*this.config.spawnRate),n=Date.now();for(let e=0;e<s;e++)this.spawnQueue.push({x:void 0,y:void 0,username:t,scheduledTime:n+e*this.config.spawnDelay})}updateConfig(e){this.config={...this.config,...e},this.updateCachedFont(),void 0!==e.objectScale&&this.precomputeVertices()}getConfig(){return{...this.config}}clear(){for(const e of this.objects)e.active&&Matter.Composite.remove(this.world,e.body);this.objects=[],this.objectPool=[],this.spawnQueue=[]}getCanvas(){return this.render.canvas}getObjectCount(){return this.objects.filter(e=>e.active).length}getPoolSize(){return this.objectPool.length}destroy(){this.stop(),this.clear(),window.removeEventListener("resize",this.boundHandleResize),Matter.Events.off(this.engine,"afterUpdate",this.boundAfterUpdate),Matter.Events.off(this.render,"afterRender",this.boundAfterRender),this.render.canvas.parentNode&&this.render.canvas.parentNode.removeChild(this.render.canvas),Matter.Engine.clear(this.engine)}}const s=document.querySelector("#elements-container");let n=[],i=[],o=null;const r={queue:[],maxWaitTime:1e3,minInterval:50,intervalId:null,lastProcessTime:0,push(e){this.queue.push({message:e,timestamp:Date.now()}),this.ensureProcessing()},ensureProcessing(){null===this.intervalId&&this.queue.length>0&&this.scheduleNext()},getProcessCount(){if(0===this.queue.length)return 0;const e=Date.now();let t=0;for(const s of this.queue){if(!(e-s.timestamp>=this.maxWaitTime))break;t++}return 0===t&&this.queue.length>0&&e-this.lastProcessTime>=this.minInterval&&(t=1),t},getDelay(){if(0===this.queue.length)return this.minInterval;const e=Date.now()-this.queue[0].timestamp,t=this.maxWaitTime-e;if(t<=0)return 0;const s=Math.floor(t/this.queue.length);return Math.max(this.minInterval,s)},scheduleNext(){if(0===this.queue.length)return void(this.intervalId=null);const e=this.getDelay();this.intervalId=setTimeout(()=>{this.processBatch(),this.scheduleNext()},e)},processBatch(){if(0===this.queue.length)return;const e=this.getProcessCount();for(let t=0;t<e&&this.queue.length>0;t++){const e=this.queue.shift();e&&b(e.message)}this.lastProcessTime=Date.now(),y()},onVisibilityChange(){"visible"===document.visibilityState&&this.queue.length>0&&(this.processBatch(),null!==this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),this.ensureProcessing())}};document.addEventListener("visibilitychange",()=>{r.onVisibilityChange()});const a=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/chat.ws`;let l=new WebSocket(a);const c=()=>l.readyState===WebSocket.OPEN||l.readyState===WebSocket.CONNECTING||(l=new WebSocket(a),d(),!1),d=()=>{l.addEventListener("open",()=>{console.log("[SNEED] Connection established.");const e=window.LAYOUT_NAME;e?(console.log("[SNEED] Subscribing to layout:",e),l.send(JSON.stringify({subscribe_layout:e}))):l.send(JSON.stringify({request_layout:!0})),console.log("[SNEED] Requesting recent messages"),l.send(JSON.stringify({request_messages:!0}))}),l.addEventListener("message",e=>{const a=JSON.parse(e.data),l=JSON.parse(a.message);switch(a.tag){case"chat_message":const e=l;console.log("[SNEED] Received message:",e.id,"containers:",n.length),function(e){const t=document.getElementById(e.id);null!==t||(function(e){if(!e.message.startsWith("!")&&null===E)return!1;let t=function(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}(e.message);const s=e.is_owner;if(t.startsWith("!poll")&&s){t=t.replace("!poll","").trim();let e=t.split(";");return e=e.filter(e=>0!==e.length),e.length>=3&&(E=new I(e[0],!1,e.slice(1))),!0}if(t.startsWith("!multipoll")&&s){t=t.replace("!multipoll","").trim();let e=t.split(";");return e=e.filter(e=>0!==e.length),e.length>=3&&(E=new I(e[0],!0,e.slice(1))),!0}return t.startsWith("!endpoll")&&s?(null!==E&&E.end_poll(),!0):!(null===E||!E.is_valid_vote(e.message))&&(E.handle_vote_message(e),!0)}(e)||(e.amount>0?b(e):r.push(e)))}(e);break;case"feature_message":console.log("[SNEED] Received feature_message event:",l),p(l);break;case"viewers":!function(e){console.log("VIEWERS",e);for(const[t,s]of Object.entries(e))window.livestream_viewers[t]="number"==typeof s?s:parseInt(s,10);const t=o?.elements||{};for(const[e,s]of Object.entries(t))if("live"===e.replace(/-\d+$/,"")&&!1!==s.enabled){const t=document.getElementById(e),n=t?.querySelector(".live-totals");if(n){const e=s.options,t=S(window.livestream_viewers,e);n.innerHTML=t.toString()}}}(l);break;case"layout_update":!function(e){if(console.log("[SNEED] Applying layout:",e.name),o=e,!s)return void console.error("[SNEED] Elements container not found!");const r=e.elements||{},a=new Set;for(const e of Array.from(s.children))e.id&&a.add(e.id);const l=new Set(Object.keys(r).filter(e=>!1!==r[e]?.enabled));for(const e of a)if(!l.has(e)){const t=document.getElementById(e);if(t){const s=i.findIndex(t=>t.elementId===e);-1!==s&&(i[s].instance.destroy(),i.splice(s,1));const o=n.findIndex(t=>t.elementId===e);-1!==o&&n.splice(o,1),t.remove()}}for(const[o,a]of Object.entries(r)){if(!a||!1===a.enabled)continue;const r=o.replace(/-\d+$/,"");let l=document.getElementById(o);if(l){if(m(l,a,"text"===r||"attribution"===r),"chat"===r){const t=a.options||{},s=e.messageStyle||{};l.classList.toggle("chat--condensed",!0===(t.condensedMode??s.condensedMode)),l.classList.toggle("chat--no-avatars",!1===(t.showAvatars??s.showAvatars)),l.classList.toggle("chat--no-usernames",!1===(t.showUsernames??s.showUsernames)),l.classList.toggle("chat--top-first","top"===(t.direction??s.direction));const i=n.find(e=>e.elementId===o);i&&(i.options={showAvatars:t.showAvatars??s.showAvatars??!0,showUsernames:t.showUsernames??s.showUsernames??!0,condensedMode:t.condensedMode??s.condensedMode??!1,direction:t.direction??s.direction??"bottom",showOwnerBadge:t.showOwnerBadge??s.showOwnerBadge??!0,showStaffBadge:t.showStaffBadge??s.showStaffBadge??!0,showModBadge:t.showModBadge??s.showModBadge??!0,showVerifiedBadge:t.showVerifiedBadge??s.showVerifiedBadge??!0,showSubBadge:t.showSubBadge??s.showSubBadge??!0})}}else if(console.log("[SNEED] Creating element:",o,"type:",r),l=u(o,r,a),l){if(s.appendChild(l),m(l,a,"text"===r||"attribution"===r),"chat"===r){const t=l.querySelector(".chat-messages");if(t){const s=a.options||{},i=e.messageStyle||{},r={showAvatars:s.showAvatars??i.showAvatars??!0,showUsernames:s.showUsernames??i.showUsernames??!0,condensedMode:s.condensedMode??i.condensedMode??!1,direction:s.direction??i.direction??"bottom",showOwnerBadge:s.showOwnerBadge??i.showOwnerBadge??!0,showStaffBadge:s.showStaffBadge??i.showStaffBadge??!0,showModBadge:s.showModBadge??i.showModBadge??!0,showVerifiedBadge:s.showVerifiedBadge??i.showVerifiedBadge??!0,showSubBadge:s.showSubBadge??i.showSubBadge??!0};n.push({container:t,elementId:o,options:r}),l.classList.toggle("chat--condensed",!0===r.condensedMode),l.classList.toggle("chat--no-avatars",!1===r.showAvatars),l.classList.toggle("chat--no-usernames",!1===r.showUsernames),l.classList.toggle("chat--top-first","top"===r.direction)}}if("matter"===r)if("undefined"!=typeof Matter)try{const e=a.options||{},s=new t(l,e);s.start(),i.push({instance:s,elementId:o}),console.log("[SNEED] DonationMatter initialized for element:",o)}catch(e){console.error("[SNEED] Failed to initialize DonationMatter:",e)}else console.warn("[SNEED] Matter.js not loaded, cannot initialize DonationMatter")}}if(e.messageStyle){const t=e.messageStyle,s=document.documentElement;t.avatarSize&&s.style.setProperty("--avatar-size",t.avatarSize),t.maxHeight&&s.style.setProperty("--message-max-height",t.maxHeight),t.borderRadius&&s.style.setProperty("--message-border-radius",t.borderRadius),t.fontSize&&s.style.setProperty("--message-font-size",t.fontSize),t.backgroundColor&&s.style.setProperty("--message-bg",t.backgroundColor),t.textColor&&s.style.setProperty("--message-color",t.textColor),window.badgeSettings={owner:!1!==t.showOwnerBadge,staff:!1!==t.showStaffBadge,mod:!1!==t.showModBadge,verified:!1!==t.showVerifiedBadge,sub:!1!==t.showSubBadge}}const c=Object.entries(r).find(([e])=>"chat"===e||e.startsWith("chat-"))?.[1];if(c?.size?.width){const e=c.size.width,t="number"==typeof e?`${e}px`:e;document.documentElement.style.setProperty("--chat-width",t)}y()}(l);break;case"layout_list":console.log("[SNEED] Available layouts:",l);break;default:console.log("Unknown tag:",a.tag)}}),l.addEventListener("close",e=>{console.log("[SNEED] Socket has closed. Attempting reconnect.",e.reason),setTimeout(()=>{c()},1e3)}),l.addEventListener("error",()=>{l.close(),setTimeout(()=>{c()},1e3)})};d();let h=null;function u(e,t,s){const n=document.createElement("section");switch(n.id=e,n.className=`element element--${t}`,t){case"chat":n.innerHTML='\n                <div class="chat-messages"></div>\n                <div class="flyout">\n                    <div class="poll-ui"></div>\n                    <div class="superchat-ui"></div>\n                </div>\n            ';break;case"live":const e=s.options,i=!0===e?.showIcon,o=!1!==e?.showLabel,r=!1!==e?.showCount;n.innerHTML=`\n                ${i?'<span class="live-icon live-badge">ðŸ“º</span>':""}\n                ${o?'<span class="live-label live-badge">LIVE</span>':""}\n                ${r?'<span class="live-totals live-badge">0</span>':""}\n            `;break;case"text":case"attribution":const a=s.options?.content||"";n.innerHTML=g(a);break;case"featured":n.className+=" show-message";break;case"poll":n.className+=" poll-ui";break;case"superchat":n.className+=" superchat-ui";break;case"matter":n.style.overflow="hidden";break;default:return console.warn(`[SNEED] Unknown element type: ${t}`),null}return n}function g(e){return e?e.replace(/\{\{([a-zA-Z_][a-zA-Z0-9_]*)(?::([^}]*))?\}\}/g,(e,t,s)=>"datetime"===t||"date"===t||"time"===t?function(e,t){const s=(e,t=2)=>e.toString().padStart(t,"0"),n={yyyy:e.getFullYear().toString(),yy:e.getFullYear().toString().slice(-2),MMMM:["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()],MMM:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],MM:s(e.getMonth()+1),M:(e.getMonth()+1).toString(),do:(e=>{const t=["th","st","nd","rd"],s=e%100;return e+(t[(s-20)%10]||t[s]||t[0])})(e.getDate()),dd:s(e.getDate()),d:e.getDate().toString(),EEEE:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()],EEE:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()],HH:s(e.getHours()),H:e.getHours().toString(),hh:s(e.getHours()%12||12),h:(e.getHours()%12||12).toString(),mm:s(e.getMinutes()),m:e.getMinutes().toString(),ss:s(e.getSeconds()),s:e.getSeconds().toString(),a:e.getHours()<12?"AM":"PM"},i=Object.keys(n).sort((e,t)=>t.length-e.length);let o="",r=0;for(;r<t.length;){let e=!1;for(const s of i)if(t.substring(r,r+s.length)===s){o+=n[s],r+=s.length,e=!0;break}e||(o+=t[r],r++)}return o}(new Date,s||function(e){switch(e){case"date":return"MMMM d, yyyy";case"time":return"HH:mm:ss";default:return"yyyy-MM-dd HH:mm:ss"}}(t)):"year"===t?(new Date).getFullYear().toString():e):e}function m(e,t,s=!1){if(!e)return;if(!t)return void(e.style.display="none");if(console.log("[SNEED] Applying config to element:",e.id,t),!1===t.enabled)return void(e.style.display="none");if(e.style.display="",s&&void 0!==t.options?.content){const s=g(t.options.content);e.innerHTML=s}if(t.position){const s=t.position,n=e=>"number"==typeof e?`${e}px`:e;e.style.left="auto",e.style.right="auto",e.style.top="auto",e.style.bottom="auto",null!==s.x&&void 0!==s.x&&(e.style.left=n(s.x)),null!==s.y&&void 0!==s.y&&(e.style.top=n(s.y)),null!==s.right&&void 0!==s.right&&(e.style.right=n(s.right)),null!==s.bottom&&void 0!==s.bottom&&(e.style.bottom=n(s.bottom))}if(t.size){const s=t.size;!0===t.autoSize||(null!==s.width&&void 0!==s.width&&(e.style.width="number"==typeof s.width?`${s.width}px`:s.width),null!==s.height&&void 0!==s.height&&(e.style.height="number"==typeof s.height?`${s.height}px`:s.height)),s.maxWidth&&(e.style.maxWidth=s.maxWidth),s.maxHeight&&(e.style.maxHeight=s.maxHeight)}if(t.style){const s=t.style;s.backgroundColor&&(e.style.backgroundColor=s.backgroundColor),s.fontSize&&(e.style.fontSize=s.fontSize),s.fontFamily&&(e.style.fontFamily=s.fontFamily),s.fontWeight&&(e.style.fontWeight=s.fontWeight),s.fontStyle&&(e.style.fontStyle=s.fontStyle),s.color&&(e.style.color=s.color),s.lineHeight&&(e.style.lineHeight=s.lineHeight),s.letterSpacing&&(e.style.letterSpacing=s.letterSpacing),s.textAlign&&(e.style.textAlign=s.textAlign),s.padding&&(e.style.padding=s.padding),s.margin&&(e.style.margin=s.margin),s.borderRadius&&(e.style.borderRadius=s.borderRadius),null!==s.opacity&&void 0!==s.opacity&&(e.style.opacity=s.opacity.toString()),s.transform&&(e.style.transform=s.transform),null!==s.zIndex&&void 0!==s.zIndex&&(e.style.zIndex=s.zIndex.toString())}const n=t.options;if(void 0!==n?.scale){const t=n.scale;e.style.setProperty("--featured-scale",t.toString())}}h&&clearInterval(h),h=setInterval(()=>{if(o)for(const[e,t]of Object.entries(o.elements||{})){const s=e.replace(/-\d+$/,"");if(("text"===s||"attribution"===s)&&!1!==t.enabled&&t.options?.content){const s=document.getElementById(e);s&&(s.innerHTML=g(t.options.content))}}},1e3);let f=null;function p(e){const t=document.querySelectorAll(".element--featured");if(console.log("[SNEED] handle_feature_message:",e,"featured_elements:",t.length),null===e)return f=null,t.forEach(e=>e.innerHTML=""),void console.log("[SNEED] Cleared featured message");if(0===t.length)return console.log("[SNEED] No .element--featured elements found yet, storing pending feature:",e),void(f=e);const s=document.getElementById(e);if(console.log("[SNEED] Looking for message ID:",e,"found:",null!==s),null!==s){const n=s.cloneNode(!0);n.id=`feature-${e}`;const i=n.outerHTML;t.forEach(e=>{e.innerHTML=i,console.log("[SNEED] Set featured element content, innerHTML length:",e.innerHTML.length)}),f=null,console.log("[SNEED] Featured message:",e)}else{f=e,console.log("[SNEED] Featured message not found yet, waiting for buffer:",e);const t=document.querySelectorAll(".msg");console.log("[SNEED] Existing message IDs:",Array.from(t).slice(0,10).map(e=>e.id))}}function y(){f&&document.getElementById(f)&&p(f)}function w(e,t){e.querySelectorAll(".msg-badge").forEach(e=>{const s=e.className.match(/msg-badge--(\w+)/);if(s){const n=s[1];let i=!0;"owner"===n?i=!1!==t.showOwnerBadge:"staff"===n?i=!1!==t.showStaffBadge:"mod"===n?i=!1!==t.showModBadge:"verified"===n?i=!1!==t.showVerifiedBadge:"sub"===n&&(i=!1!==t.showSubBadge),i||(e.style.display="none")}})}function b(e){const t=document.getElementById(e.id);if(null!==t)return t;if(0===n.length)return null;let s=null;for(let t=0;t<n.length;t++){const{container:i,options:o}=n[t],r="top"===o.direction;let a=e.html;!1===o.showUsernames&&(a=a.replace('class="msg','class="msg msg--hide-username'));const l=document.createElement("div");i.appendChild(l);const c=0===t?e.id:`${e.id}-${t}`;l.outerHTML=a.replace(`id="${e.id}"`,`id="${c}"`);const d=document.getElementById(c);d&&(w(d,o),0===t&&(s=d,e.amount>0&&v(d,e)));const h=150;if(i.children.length>h){const e=[];for(let t=0;t<i.children.length-h;t++){const s=i.children[t];s.classList.contains("msg--sticky")||s.classList.contains("msg--t")||e.push(s)}for(const t of e)t.remove()}const u=i.parentElement;u&&(u.scrollTop=r?0:u.scrollHeight)}return s}function v(e,t){if("USD"===t.currency){e.classList.add("msg--sticky"),M();const s=Math.min(600,6*t.amount);setTimeout(()=>{e.classList.remove("msg--sticky"),M()},1e3*s);for(const e of i)e.instance.handleDonation(t.amount,t.username)}}function S(e,t){const s=t?.platformMode||"all",n=t?.platforms||[];let i=0;for(const[t,o]of Object.entries(e)){const e="number"==typeof o?o:parseInt(o,10)||0;"all"===s||"include"===s&&n.includes(t)?i+=e:"exclude"!==s||n.includes(t)||(i+=e)}return Math.max(0,i)}function M(){const e=document.getElementsByClassName("msg--sticky");let t=5;for(let s=0;s<e.length;s++)t+=e[s].offsetHeight+5;let s=document.documentElement.clientHeight/2;t=t>s?s-t:5;for(let s=0;s<e.length;s++)e[s].style.top=`${t}px`,t+=e[s].scrollHeight+5}window.livestream_viewers={};let E=null;const x=document.getElementById("poll-ui"),B=document.getElementById("superchat-ui");class I{constructor(e,t,s){this.question=e,this.options=s,this.votes=new Array(s.length).fill(0),this.voters=[],this.multi_vote=t,this.total_votes=0,this.update(),x&&(x.style.display="block",x.classList.remove("fade-out"),x.classList.add("fade-in")),B&&B.classList.add("slide-down")}end_poll(){const e=this.voters.length;let t=`<strong>${this.question}</strong><br><small>${e} participants</small><ul>`,s=0;for(let e=0;e<this.options.length;e++)this.votes[e]>this.votes[s]&&(s=e);for(let e=0;e<this.options.length;e++){let n=0;this.total_votes>0&&(n=this.votes[e]/this.total_votes*100);const i=n.toFixed(2);t+=e===s?`<li><strong>!vote ${e+1}: ${this.options[e]} - ${this.votes[e]} (${i}%)</strong></li>`:`<li>!vote ${e+1}: ${this.options[e]} - ${this.votes[e]} (${i}%)</li>`}x&&(x.innerHTML=t,setTimeout(()=>{x.classList.remove("fade-in"),x.classList.add("fade-out"),setTimeout(()=>{x.style.display="none"},500)},1e4)),E=null}update(){if(!x)return;const e=this.voters.length;let t=`<strong>${this.question}</strong><br><small>${e} participants</small><ul>`;for(let e=0;e<this.options.length;e++){let s=0;this.total_votes>0&&(s=this.votes[e]/this.total_votes*100),t+=`<li>!vote ${e+1}: ${this.options[e]} - ${this.votes[e]} (${s.toFixed(2)}%)</li>`}t+="</ul><small>use !vote [number] to vote</small>",x.innerHTML=t}handle_vote_message(e){if(this.voters.includes(e.username))return;const t=e.message.replace("!vote","").replace("!","").trim();let s=!1;if(this.multi_vote){let e=t.split(" ");e=[...new Set(e)];for(const t of e)s=this.handle_vote(t)||s}else s=this.handle_vote(t);s&&(this.voters.push(e.username),this.update())}handle_vote(e){if(isNaN(parseInt(e)))return!1;const t=parseInt(e)-1;return!(t<0||t>=this.options.length||(this.votes[t]++,this.total_votes++,0))}is_valid_vote(e){return!!e.startsWith("!vote")||1===e.length&&!isNaN(parseInt(e[0]))||!(!e.startsWith("!")||isNaN(parseInt(e[1])))}}!function(e){const t=e.getDate(),s=e.toLocaleString("default",{month:"long"}),n=e.getFullYear(),i=`${s} ${t}${(e=>{if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}})(t)}, ${n}`,o=document.getElementById("date");o&&(o.innerHTML=i)}(new Date)})();