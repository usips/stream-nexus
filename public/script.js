(()=>{"use strict";const t={objectType:"ammo",objectScale:.1,objectSprites:["/static/img/ammo_556_round_a.png","/static/img/ammo_556_round_b.png","/static/img/ammo_556_round_c.png","/static/img/ammo_556_round_d.png"],restitution:.05,friction:.9,frictionAir:.01,density:.002,showLabels:!0,labelColor:"#ffff00",labelFont:"Verlag",labelSize:12,spawnRate:2,spawnDelay:50,maxObjects:500,showAngleIndicator:!0,wireframes:!1,fps:24};class e{constructor(e,s={}){this.objects=[],this.isRunning=!1,this.config={...t,...s},this.viewportWidth=window.innerWidth,this.viewportHeight=window.innerHeight,document.body.style.overflow="hidden",document.body.style.margin="0",document.body.style.padding="0",this.engine=Matter.Engine.create({enableSleeping:!0,positionIterations:10,velocityIterations:8,constraintIterations:4}),this.world=this.engine.world,this.engine.gravity.y=.8,this.render=Matter.Render.create({element:e,engine:this.engine,options:{width:this.viewportWidth,height:this.viewportHeight,showAngleIndicator:this.config.showAngleIndicator,showBounds:!1,showSleeping:!1,wireframes:this.config.wireframes,background:"transparent"}}),this.runner=Matter.Runner.create(),this.bottomWall=Matter.Bodies.rectangle(this.viewportWidth/2,this.viewportHeight+25,this.viewportWidth,50,{isStatic:!0,render:{visible:!1}}),this.leftWall=Matter.Bodies.rectangle(-25,this.viewportHeight/2,50,2*this.viewportHeight,{isStatic:!0,render:{visible:!1}}),this.rightWall=Matter.Bodies.rectangle(this.viewportWidth+25,this.viewportHeight/2,50,2*this.viewportHeight,{isStatic:!0,render:{visible:!1}}),Matter.Composite.add(this.world,[this.bottomWall,this.leftWall,this.rightWall]);const i=Matter.Mouse.create(this.render.canvas),o=Matter.MouseConstraint.create(this.engine,{mouse:i,constraint:{stiffness:.2,render:{visible:!1}}});Matter.Composite.add(this.world,o),this.render.mouse=i,this.setupEventHandlers(),window.addEventListener("resize",this.handleResize.bind(this))}setupEventHandlers(){Matter.Events.on(this.engine,"afterUpdate",()=>{this.checkBoundaries(),this.cleanupExcessObjects()}),Matter.Events.on(this.render,"afterRender",()=>{this.config.showLabels&&this.renderLabels()})}checkBoundaries(){const t=Matter.Composite.allBodies(this.world);for(const e of t){if(e.isStatic)continue;let t=!1;const s={x:e.position.x,y:e.position.y};e.position.x<0?(s.x=50,t=!0):e.position.x>this.viewportWidth&&(s.x=this.viewportWidth-50,t=!0),e.position.y>this.viewportHeight&&(s.y=this.viewportHeight-50,t=!0),t&&(Matter.Body.setVelocity(e,{x:0,y:0}),Matter.Body.setAngularVelocity(e,0),Matter.Body.setPosition(e,s),e.isSleeping&&Matter.Sleeping.set(e,!1))}}cleanupExcessObjects(){for(;this.objects.length>this.config.maxObjects;){const t=this.objects.shift();t&&Matter.Composite.remove(this.world,t.body)}}renderLabels(){const t=this.render.canvas.getContext("2d");if(!t)return;const e=Matter.Composite.allBodies(this.world);for(const s of e){const e=s.label;if(e?.text&&!s.isStatic){t.save();const i=s.position.x,o=s.position.y;t.translate(i,o),t.rotate(s.angle+Math.PI/2),t.font=`${this.config.labelSize}px ${this.config.labelFont}`,t.fillStyle=e.color||this.config.labelColor,t.strokeStyle="#000000",t.lineWidth=2,t.textAlign="center",t.textBaseline="bottom",t.strokeText(e.text,10,6),t.fillText(e.text,10,6),t.restore()}}}handleResize(){const t=window.innerWidth,e=window.innerHeight;this.render.canvas.width=t,this.render.canvas.height=e,this.render.options.width=t,this.render.options.height=e,Matter.Render.lookAt(this.render,{min:{x:0,y:0},max:{x:t,y:e}}),Matter.Body.setPosition(this.bottomWall,{x:t/2,y:e+25}),Matter.Body.scale(this.bottomWall,t/(this.bottomWall.bounds.max.x-this.bottomWall.bounds.min.x),1),Matter.Body.setPosition(this.leftWall,{x:-25,y:e/2}),Matter.Body.scale(this.leftWall,1,2*e/(this.leftWall.bounds.max.y-this.leftWall.bounds.min.y)),Matter.Body.setPosition(this.rightWall,{x:t+25,y:e/2}),Matter.Body.scale(this.rightWall,1,2*e/(this.rightWall.bounds.max.y-this.rightWall.bounds.min.y));const s=Matter.Composite.allBodies(this.world);for(const i of s)if(i.isSleeping&&!i.isStatic&&Matter.Sleeping.set(i,!1),!i.isStatic){const s={x:i.position.x,y:i.position.y};let o=!1;i.position.x>t&&(s.x=t-50,o=!0),i.position.x<0&&(s.x=50,o=!0),i.position.y>e&&(s.y=e-50,o=!0),o&&(Matter.Body.setPosition(i,s),Matter.Body.setVelocity(i,{x:0,y:0}))}this.viewportWidth=t,this.viewportHeight=e}start(){this.isRunning||(Matter.Render.run(this.render),Matter.Runner.run(this.runner,this.engine),Matter.Render.lookAt(this.render,{min:{x:0,y:0},max:{x:this.viewportWidth,y:this.viewportHeight}}),this.isRunning=!0)}stop(){this.isRunning&&(Matter.Render.stop(this.render),Matter.Runner.stop(this.runner),this.isRunning=!1)}spawnObject(t,e,s){if(void 0===e&&(e=-100),void 0===t){const e=this.viewportWidth/2,s=this.viewportWidth/2.5,i=2*Math.random()-1;t=e+s*i*i*(i<0?-1:1)}const i=["85 0","105 120","115 200","115 780","105 800","125 850","125 980","45 980","45 850","65 800","55 780","55 200","65 120"].join(" "),o=Matter.Vertices.fromPath(i,void 0),n=this.config.objectSprites[Math.floor(Math.random()*this.config.objectSprites.length)],r=Matter.Bodies.fromVertices(t,e,[o],{render:{sprite:{texture:n,xScale:this.config.objectScale,yScale:this.config.objectScale}},restitution:this.config.restitution,friction:this.config.friction,frictionAir:this.config.frictionAir,density:this.config.density,slop:.01,frictionStatic:.9});return Matter.Body.scale(r,this.config.objectScale,this.config.objectScale),s&&this.config.showLabels&&(r.label={text:s,color:this.config.labelColor}),Matter.Body.setAngle(r,Math.random()*Math.PI*2),Matter.Composite.add(this.world,r),this.objects.push({body:r,username:s}),r}handleDonation(t,e){const s=Math.floor(t*this.config.spawnRate);for(let t=0;t<s;t++)setTimeout(()=>{this.spawnObject(void 0,void 0,e)},t*this.config.spawnDelay)}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}clear(){for(const t of this.objects)Matter.Composite.remove(this.world,t.body);this.objects=[]}getCanvas(){return this.render.canvas}destroy(){this.stop(),this.clear(),window.removeEventListener("resize",this.handleResize.bind(this)),this.render.canvas.parentNode&&this.render.canvas.parentNode.removeChild(this.render.canvas),Matter.Engine.clear(this.engine)}}const s=document.querySelector("#elements-container"),i=document.querySelector("#show-message");let o=[],n=[],r=null;const a={queue:[],maxWaitTime:1e3,minInterval:50,intervalId:null,lastProcessTime:0,push(t){this.queue.push({message:t,timestamp:Date.now()}),this.ensureProcessing()},ensureProcessing(){null===this.intervalId&&this.queue.length>0&&this.scheduleNext()},getProcessCount(){if(0===this.queue.length)return 0;const t=Date.now();let e=0;for(const s of this.queue){if(!(t-s.timestamp>=this.maxWaitTime))break;e++}return 0===e&&this.queue.length>0&&t-this.lastProcessTime>=this.minInterval&&(e=1),e},getDelay(){if(0===this.queue.length)return this.minInterval;const t=Date.now()-this.queue[0].timestamp,e=this.maxWaitTime-t;if(e<=0)return 0;const s=Math.floor(e/this.queue.length);return Math.max(this.minInterval,s)},scheduleNext(){if(0===this.queue.length)return void(this.intervalId=null);const t=this.getDelay();this.intervalId=setTimeout(()=>{this.processBatch(),this.scheduleNext()},t)},processBatch(){if(0===this.queue.length)return;const t=this.getProcessCount();for(let e=0;e<t&&this.queue.length>0;e++){const t=this.queue.shift();t&&y(t.message)}this.lastProcessTime=Date.now()},onVisibilityChange(){"visible"===document.visibilityState&&this.queue.length>0&&(this.processBatch(),null!==this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),this.ensureProcessing())}};document.addEventListener("visibilitychange",()=>{a.onVisibilityChange()});const l=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/chat.ws`;let c=new WebSocket(l);const h=()=>c.readyState===WebSocket.OPEN||c.readyState===WebSocket.CONNECTING||(c=new WebSocket(l),d(),!1),d=()=>{c.addEventListener("open",()=>{console.log("[SNEED] Connection established.");const t=window.LAYOUT_NAME;t?(console.log("[SNEED] Subscribing to layout:",t),c.send(JSON.stringify({subscribe_layout:t}))):c.send(JSON.stringify({request_layout:!0}))}),c.addEventListener("message",t=>{const l=JSON.parse(t.data),c=JSON.parse(l.message);switch(l.tag){case"chat_message":!function(t){const e=document.getElementById(t.id);null!==e||(function(t){if(!t.message.startsWith("!")&&null===M)return!1;let e=function(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}(t.message);const s=t.is_owner;if(e.startsWith("!poll")&&s){e=e.replace("!poll","").trim();let t=e.split(";");return t=t.filter(t=>0!==t.length),t.length>=3&&(M=new E(t[0],!1,t.slice(1))),!0}if(e.startsWith("!multipoll")&&s){e=e.replace("!multipoll","").trim();let t=e.split(";");return t=t.filter(t=>0!==t.length),t.length>=3&&(M=new E(t[0],!0,t.slice(1))),!0}return e.startsWith("!endpoll")&&s?(null!==M&&M.end_poll(),!0):!(null===M||!M.is_valid_vote(t.message))&&(M.handle_vote_message(t),!0)}(t)||(t.amount>0?y(t):a.push(t)))}(c);break;case"feature_message":!function(t){if(i)if(null===t)i.innerHTML="";else{const e=document.getElementById(t);if(null!==e){const s=e.cloneNode(!0);s.id=`feature-${t}`,i.innerHTML=s.outerHTML}else console.log("Featured chat message not found:",t)}}(c);break;case"viewers":!function(t){console.log("VIEWERS",t);for(const[e,s]of Object.entries(t))window.livestream_viewers[e]="number"==typeof s?s:parseInt(s,10);const e=r?.elements||{};for(const[t,s]of Object.entries(e))if("live"===t.replace(/-\d+$/,"")&&!1!==s.enabled){const e=document.getElementById(t),i=e?.querySelector(".live-totals");if(i){const t=s.options,e=w(window.livestream_viewers,t);i.innerHTML=e.toString()}}}(c);break;case"layout_update":!function(t){if(console.log("[SNEED] Applying layout:",t.name),r=t,!s)return void console.error("[SNEED] Elements container not found!");const a=t.elements||{};for(const t of n)t.instance.destroy();n=[],s.innerHTML="",o=[];for(const[i,r]of Object.entries(a)){if(!r||!1===r.enabled)continue;const a=i.replace(/-\d+$/,""),l=g(i,a,r);if(l){if(s.appendChild(l),f(l,r,"text"===a||"attribution"===a),"chat"===a){const e=l.querySelector(".chat-messages");if(e){const s=r.options||{},n=t.messageStyle||{},a={showAvatars:s.showAvatars??n.showAvatars??!0,showUsernames:s.showUsernames??n.showUsernames??!0,condensedMode:s.condensedMode??n.condensedMode??!1,direction:s.direction??n.direction??"bottom",showOwnerBadge:s.showOwnerBadge??n.showOwnerBadge??!0,showStaffBadge:s.showStaffBadge??n.showStaffBadge??!0,showModBadge:s.showModBadge??n.showModBadge??!0,showVerifiedBadge:s.showVerifiedBadge??n.showVerifiedBadge??!0,showSubBadge:s.showSubBadge??n.showSubBadge??!0};o.push({container:e,elementId:i,options:a}),l.classList.toggle("chat--condensed",!0===a.condensedMode),l.classList.toggle("chat--no-avatars",!1===a.showAvatars),l.classList.toggle("chat--no-usernames",!1===a.showUsernames),l.classList.toggle("chat--top-first","top"===a.direction)}}if("matter"===a)if("undefined"!=typeof Matter)try{const t=r.options||{},s=new e(l,t);s.start(),n.push({instance:s,elementId:i}),console.log("[SNEED] DonationMatter initialized for element:",i)}catch(t){console.error("[SNEED] Failed to initialize DonationMatter:",t)}else console.warn("[SNEED] Matter.js not loaded, cannot initialize DonationMatter")}}if(i){const t=Object.entries(a).find(([t])=>"featured"===t||t.startsWith("featured-"))?.[1];if(t?.position){const e=t.position,s=t=>"number"==typeof t?`${t}px`:t;i.style.left="auto",i.style.right="auto",i.style.top="auto",i.style.bottom="auto",null!==e.x&&void 0!==e.x&&(i.style.left=s(e.x)),null!==e.y&&void 0!==e.y&&(i.style.top=s(e.y)),null!==e.right&&void 0!==e.right&&(i.style.right=s(e.right)),null!==e.bottom&&void 0!==e.bottom&&(i.style.bottom=s(e.bottom))}if(t?.size){const e=t.size;null!==e.width&&void 0!==e.width&&(i.style.width="number"==typeof e.width?`${e.width}px`:e.width),e.maxWidth&&(i.style.maxWidth=e.maxWidth)}}if(t.messageStyle){const e=t.messageStyle,s=document.documentElement;e.avatarSize&&s.style.setProperty("--avatar-size",e.avatarSize),e.maxHeight&&s.style.setProperty("--message-max-height",e.maxHeight),e.borderRadius&&s.style.setProperty("--message-border-radius",e.borderRadius),e.fontSize&&s.style.setProperty("--message-font-size",e.fontSize),e.backgroundColor&&s.style.setProperty("--message-bg",e.backgroundColor),e.textColor&&s.style.setProperty("--message-color",e.textColor),window.badgeSettings={owner:!1!==e.showOwnerBadge,staff:!1!==e.showStaffBadge,mod:!1!==e.showModBadge,verified:!1!==e.showVerifiedBadge,sub:!1!==e.showSubBadge}}const l=Object.entries(a).find(([t])=>"chat"===t||t.startsWith("chat-"))?.[1];if(l?.size?.width){const t=l.size.width,e="number"==typeof t?`${t}px`:t;document.documentElement.style.setProperty("--chat-width",e)}}(c);break;case"layout_list":console.log("[SNEED] Available layouts:",c);break;default:console.log("Unknown tag:",l.tag)}}),c.addEventListener("close",t=>{console.log("[SNEED] Socket has closed. Attempting reconnect.",t.reason),setTimeout(()=>{h()},1e3)}),c.addEventListener("error",()=>{c.close(),setTimeout(()=>{h()},1e3)})};d();let u=null;function g(t,e,s){const i=document.createElement("section");switch(i.id=t,i.className=`element element--${e}`,e){case"chat":i.innerHTML='\n                <div class="chat-messages"></div>\n                <div class="flyout">\n                    <div class="poll-ui"></div>\n                    <div class="superchat-ui"></div>\n                </div>\n            ';break;case"live":const t=s.options,o=!0===t?.showIcon,n=!1!==t?.showLabel,r=!1!==t?.showCount;i.innerHTML=`\n                ${o?'<span class="live-icon live-badge">ðŸ“º</span>':""}\n                ${n?'<span class="live-label live-badge">LIVE</span>':""}\n                ${r?'<span class="live-totals live-badge">0</span>':""}\n            `;break;case"text":case"attribution":const a=s.options?.content||"";i.innerHTML=m(a);break;case"featured":i.className+=" show-message";break;case"poll":i.className+=" poll-ui";break;case"superchat":i.className+=" superchat-ui";break;case"matter":i.style.overflow="hidden";break;default:return console.warn(`[SNEED] Unknown element type: ${e}`),null}return i}function m(t){return t?t.replace(/\{\{([a-zA-Z_][a-zA-Z0-9_]*)(?::([^}]*))?\}\}/g,(t,e,s)=>"datetime"===e||"date"===e||"time"===e?function(t,e){const s=(t,e=2)=>t.toString().padStart(e,"0"),i={yyyy:t.getFullYear().toString(),yy:t.getFullYear().toString().slice(-2),MMMM:["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()],MMM:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],MM:s(t.getMonth()+1),M:(t.getMonth()+1).toString(),do:(t=>{const e=["th","st","nd","rd"],s=t%100;return t+(e[(s-20)%10]||e[s]||e[0])})(t.getDate()),dd:s(t.getDate()),d:t.getDate().toString(),EEEE:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()],EEE:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()],HH:s(t.getHours()),H:t.getHours().toString(),hh:s(t.getHours()%12||12),h:(t.getHours()%12||12).toString(),mm:s(t.getMinutes()),m:t.getMinutes().toString(),ss:s(t.getSeconds()),s:t.getSeconds().toString(),a:t.getHours()<12?"AM":"PM"},o=Object.keys(i).sort((t,e)=>e.length-t.length);let n="",r=0;for(;r<e.length;){let t=!1;for(const s of o)if(e.substring(r,r+s.length)===s){n+=i[s],r+=s.length,t=!0;break}t||(n+=e[r],r++)}return n}(new Date,s||function(t){switch(t){case"date":return"MMMM d, yyyy";case"time":return"HH:mm:ss";default:return"yyyy-MM-dd HH:mm:ss"}}(e)):"year"===e?(new Date).getFullYear().toString():t):t}function f(t,e,s=!1){if(t)if(e)if(console.log("[SNEED] Applying config to element:",t.id,e),!1!==e.enabled){if(t.style.display="",s&&void 0!==e.options?.content){const s=m(e.options.content);t.innerHTML=s}if(e.position){const s=e.position,i=t=>"number"==typeof t?`${t}px`:t;t.style.left="auto",t.style.right="auto",t.style.top="auto",t.style.bottom="auto",null!==s.x&&void 0!==s.x&&(t.style.left=i(s.x)),null!==s.y&&void 0!==s.y&&(t.style.top=i(s.y)),null!==s.right&&void 0!==s.right&&(t.style.right=i(s.right)),null!==s.bottom&&void 0!==s.bottom&&(t.style.bottom=i(s.bottom))}if(e.size){const s=e.size;null!==s.width&&void 0!==s.width&&(t.style.width="number"==typeof s.width?`${s.width}px`:s.width),null!==s.height&&void 0!==s.height&&(t.style.height="number"==typeof s.height?`${s.height}px`:s.height),s.maxWidth&&(t.style.maxWidth=s.maxWidth),s.maxHeight&&(t.style.maxHeight=s.maxHeight)}if(e.style){const s=e.style;s.backgroundColor&&(t.style.backgroundColor=s.backgroundColor),s.fontSize&&(t.style.fontSize=s.fontSize),s.fontFamily&&(t.style.fontFamily=s.fontFamily),s.fontWeight&&(t.style.fontWeight=s.fontWeight),s.fontStyle&&(t.style.fontStyle=s.fontStyle),s.color&&(t.style.color=s.color),s.padding&&(t.style.padding=s.padding),s.margin&&(t.style.margin=s.margin),s.borderRadius&&(t.style.borderRadius=s.borderRadius),null!==s.opacity&&void 0!==s.opacity&&(t.style.opacity=s.opacity.toString()),s.transform&&(t.style.transform=s.transform),null!==s.zIndex&&void 0!==s.zIndex&&(t.style.zIndex=s.zIndex.toString())}}else t.style.display="none";else t.style.display="none"}function p(t,e){t.querySelectorAll(".msg-badge").forEach(t=>{const s=t.className.match(/msg-badge--(\w+)/);if(s){const i=s[1];let o=!0;"owner"===i?o=!1!==e.showOwnerBadge:"staff"===i?o=!1!==e.showStaffBadge:"mod"===i?o=!1!==e.showModBadge:"verified"===i?o=!1!==e.showVerifiedBadge:"sub"===i&&(o=!1!==e.showSubBadge),o||(t.style.display="none")}})}function y(t){const e=document.getElementById(t.id);if(null!==e)return e;if(0===o.length)return null;let s=null;for(let e=0;e<o.length;e++){const{container:i,options:n}=o[e],r="top"===n.direction;let a=t.html;!1===n.showUsernames&&(a=a.replace('class="msg','class="msg msg--hide-username'));const l=document.createElement("div");i.appendChild(l);const c=0===e?t.id:`${t.id}-${e}`;l.outerHTML=a.replace(`id="${t.id}"`,`id="${c}"`);const h=document.getElementById(c);for(h&&(p(h,n),0===e&&(s=h,t.amount>0&&v(h,t)));i.children.length>1e3;){const t=i.children[0];if(t.classList.contains("msg--sticky")||t.classList.contains("msg--t")){if(!(i.children.length>1))break;{const t=i.children[1];if(!t||t.classList.contains("msg--sticky")||t.classList.contains("msg--t"))break;t.remove()}}else t.remove()}const d=i.parentElement;d&&(d.scrollTop=r?0:d.scrollHeight)}return s}function v(t,e){if("USD"===e.currency){t.classList.add("msg--sticky"),b();const s=Math.min(600,6*e.amount);setTimeout(()=>{t.classList.remove("msg--sticky"),b()},1e3*s);for(const t of n)t.instance.handleDonation(e.amount,e.username)}}function w(t,e){const s=e?.platformMode||"all",i=e?.platforms||[];let o=0;for(const[e,n]of Object.entries(t)){const t="number"==typeof n?n:parseInt(n,10)||0;"all"===s||"include"===s&&i.includes(e)?o+=t:"exclude"!==s||i.includes(e)||(o+=t)}return Math.max(0,o)}function b(){const t=document.getElementsByClassName("msg--sticky");let e=5;for(let s=0;s<t.length;s++)e+=t[s].offsetHeight+5;let s=document.documentElement.clientHeight/2;e=e>s?s-e:5;for(let s=0;s<t.length;s++)t[s].style.top=`${e}px`,e+=t[s].scrollHeight+5}u&&clearInterval(u),u=setInterval(()=>{if(r)for(const[t,e]of Object.entries(r.elements||{})){const s=t.replace(/-\d+$/,"");if(("text"===s||"attribution"===s)&&!1!==e.enabled&&e.options?.content){const s=document.getElementById(t);s&&(s.innerHTML=m(e.options.content))}}},1e3),window.livestream_viewers={};let M=null;const S=document.getElementById("poll-ui"),x=document.getElementById("superchat-ui");class E{constructor(t,e,s){this.question=t,this.options=s,this.votes=new Array(s.length).fill(0),this.voters=[],this.multi_vote=e,this.total_votes=0,this.update(),S&&(S.style.display="block",S.classList.remove("fade-out"),S.classList.add("fade-in")),x&&x.classList.add("slide-down")}end_poll(){const t=this.voters.length;let e=`<strong>${this.question}</strong><br><small>${t} participants</small><ul>`,s=0;for(let t=0;t<this.options.length;t++)this.votes[t]>this.votes[s]&&(s=t);for(let t=0;t<this.options.length;t++){let i=0;this.total_votes>0&&(i=this.votes[t]/this.total_votes*100);const o=i.toFixed(2);e+=t===s?`<li><strong>!vote ${t+1}: ${this.options[t]} - ${this.votes[t]} (${o}%)</strong></li>`:`<li>!vote ${t+1}: ${this.options[t]} - ${this.votes[t]} (${o}%)</li>`}S&&(S.innerHTML=e,setTimeout(()=>{S.classList.remove("fade-in"),S.classList.add("fade-out"),setTimeout(()=>{S.style.display="none"},500)},1e4)),M=null}update(){if(!S)return;const t=this.voters.length;let e=`<strong>${this.question}</strong><br><small>${t} participants</small><ul>`;for(let t=0;t<this.options.length;t++){let s=0;this.total_votes>0&&(s=this.votes[t]/this.total_votes*100),e+=`<li>!vote ${t+1}: ${this.options[t]} - ${this.votes[t]} (${s.toFixed(2)}%)</li>`}e+="</ul><small>use !vote [number] to vote</small>",S.innerHTML=e}handle_vote_message(t){if(this.voters.includes(t.username))return;const e=t.message.replace("!vote","").replace("!","").trim();let s=!1;if(this.multi_vote){let t=e.split(" ");t=[...new Set(t)];for(const e of t)s=this.handle_vote(e)||s}else s=this.handle_vote(e);s&&(this.voters.push(t.username),this.update())}handle_vote(t){if(isNaN(parseInt(t)))return!1;const e=parseInt(t)-1;return!(e<0||e>=this.options.length||(this.votes[e]++,this.total_votes++,0))}is_valid_vote(t){return!!t.startsWith("!vote")||1===t.length&&!isNaN(parseInt(t[0]))||!(!t.startsWith("!")||isNaN(parseInt(t[1])))}}!function(t){const e=t.getDate(),s=t.toLocaleString("default",{month:"long"}),i=t.getFullYear(),o=`${s} ${e}${(t=>{if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}})(e)}, ${i}`,n=document.getElementById("date");n&&(n.innerHTML=o)}(new Date)})();