(()=>{"use strict";const e=document.querySelector("#chat-history"),t=document.querySelector("#donation-history");class n{constructor(e,t,n){this.id=e,this.platform=t,this.channel=n,this.sent_at=Math.round(Date.now()/1e3),this.received_at=Math.round(Date.now()/1e3),this.message="",this.html="",this.emojis=[],this.username="DUMMY_USER",this.avatar="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",this.amount=0,this.currency="ZWL",this.is_placeholder=!1,this.is_verified=!1,this.is_sub=!1,this.is_mod=!1,this.is_owner=!1,this.is_staff=!1}}const o=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/chat.ws`;let s=null;function l(e=1){const t=document.querySelector("#poll-options");if(t)for(let n=0;n<e;n++){const e=document.createElement("input");e.setAttribute("type","text"),e.setAttribute("placeholder","Poll option"),e.setAttribute("class","poll-option"),e.setAttribute("onkeydown","on_poll_option_type(event)"),e.setAttribute("onblur","on_poll_option_change(event)"),t.appendChild(e)}}function i(){this.classList.contains("msg--sticky")?c(null):c(this.id)}function c(e){console.log("Featuring message:",e);const t={feature_message:e};s?.send(JSON.stringify(t))}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function r(e){const t={platform:"none",messages:[e]};s?.send(JSON.stringify(t))}function u(e,t=!1){const o=new n(a(),"none","none");o.message=e,o.is_owner=t,r(o)}!function(){s=new WebSocket(o);const n=()=>!(!s||s.readyState!==WebSocket.OPEN&&s.readyState!==WebSocket.CONNECTING)||(s=new WebSocket(o),l(),!1),l=()=>{s&&(s.addEventListener("open",()=>{console.log("[SNEED] Connection established.")}),s.addEventListener("message",n=>{const o=JSON.parse(n.data),s=JSON.parse(o.message);switch(o.tag){case"chat_message":!function(n){if(n.is_placeholder)return null;const o=document.getElementById(n.id);if(null!==o)return o;let s=document.createElement("div");if(n.amount>0)t&&(t.appendChild(s),s.outerHTML=n.html);else if(e)for(e.appendChild(s),s.outerHTML=n.html;e.children.length>1e3;)for(let t=0;t<e.children.length;t++){const n=e.childNodes[t];if(!n.classList.contains("msg--sticky")){n.remove();break}}const l=document.getElementById(n.id);l&&l.addEventListener("click",i)}(s);break;case"feature_message":!function(e){if(document.querySelectorAll(".msg--sticky").forEach(e=>{e.classList.remove("msg--sticky")}),e){const t=document.getElementById(e);null!==t&&t.classList.add("msg--sticky")}}(s);break;case"viewers":break;default:console.log("Unknown tag:",o.tag)}}),s.addEventListener("close",e=>{console.log("[SNEED] Socket has closed. Attempting reconnect.",e.reason),setTimeout(()=>{n()},3e3)}),s.addEventListener("error",()=>{s?.close(),setTimeout(()=>{n()},3e3)}))};l()}(),document.querySelectorAll(".msg").forEach(e=>{e.addEventListener("click",i)}),window.new_poll_option=l,window.on_poll_option_type=function(e){const t=document.querySelectorAll(".poll-option");if(t.length>=15)return;const n=t[t.length-1];n&&""!==n.value&&l()},window.on_poll_option_change=function(e){if(document.querySelectorAll(".poll-option").length<=2)return;const t=e.target;""===t.value&&t.remove()},window.on_poll_create=function(){const e=document.getElementById("multiplechoice"),t=document.getElementById("pollquestion"),n=e?.checked?"multipoll":"poll",o=document.querySelectorAll(".poll-option"),s=[],i=t?.value||"";o.forEach(e=>{""!==e.value&&s.push(e.value)}),s.length<2?alert("You need at least two poll options."):""!==i?(u(`!${n} ${i}; ${s.join("; ")}`),function(){const e=document.getElementById("pollquestion");e&&(e.value=""),document.querySelectorAll(".poll-option").forEach(e=>{e.remove()}),l(2)}()):alert("You need a poll question.")},window.on_poll_end=function(){u("!endpoll",!0)},window.send_paid_message=function(){const e=new n(a(),"none","none"),t=document.getElementById("donation-platform"),o=document.getElementById("donation-username"),s=document.getElementById("donation-amount"),l=document.getElementById("donation-currency"),i=document.getElementById("donation-message");switch(e.platform=t?.value||"none",e.username=o?.value||"Anonymous",e.amount=parseFloat(s?.value||"0"),e.currency=l?.value||"USD",e.message=i?.value||"",e.platform){case"mail":case"usps":e.avatar="/static/logo/usps.png"}r(e)},window.send_simple_message=u})();